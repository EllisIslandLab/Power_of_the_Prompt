# 📊 Services Table Setup Guide - Complete Airtable Configuration

## 🎯 Overview
Your Services table needs proper structure for course enrollment limits, automated Stripe integration, and order management. Here's the complete setup guide.

## 📋 Required Airtable Fields (Services Table)

### **Core Service Fields**
| Field Name | Type | Required | Description | Manual/Auto |
|------------|------|----------|-------------|-------------|
| **Service Name** | Single line text | ✅ | Name of your service/course | Manual |
| **Service Type** | Single select | ✅ | Course, Build, Audit, Consultation | Manual |
| **Description** | Long text | ✅ | Detailed service description | Manual |
| **Price** | Currency | ✅ | Base price in dollars | Manual |
| **Category** | Single select | ✅ | Web Dev, Business, etc. | Manual |
| **Duration Estimate** | Single line text | ✅ | "4 weeks", "2-3 days" | Manual |
| **Is Active** | Checkbox | ✅ | Whether service is available | Manual |

### **Enrollment & Capacity Fields** ⭐ *NEW*
| Field Name | Type | Required | Description | Manual/Auto |
|------------|------|----------|-------------|-------------|
| **Max Seats** | Number | ❌ | Maximum enrollments (empty = unlimited) | Manual |
| **Seats Taken** | Number | ❌ | Current enrollments | Auto (from purchases) |
| **Seats Available** | Formula | ❌ | `{Max Seats} - {Seats Taken}` | Auto-calculated |
| **Enrollment Status** | Formula | ❌ | "Open", "Full", "Unlimited" | Auto-calculated |

### **Stripe Integration Fields** 
| Field Name | Type | Required | Description | Manual/Auto |
|------------|------|----------|-------------|-------------|
| **Order** | Number | ✅ | Display order (1, 2, 3...) | Manual |
| **Stripe Product ID** | Single line text | ❌ | Auto-generated by sync | Auto (API creates) |
| **Stripe Price ID** | Single line text | ❌ | Auto-generated by sync | Auto (API creates) |

### **Discount Fields** (Optional)
| Field Name | Type | Required | Description | Manual/Auto |
|------------|------|----------|-------------|-------------|
| **Sale Price** | Currency | ❌ | Discounted price | Manual |
| **Discount Percentage** | Number | ❌ | % off (25 = 25% off) | Manual |
| **Sale Start Date** | Date | ❌ | When discount starts | Manual |
| **Sale End Date** | Date | ❌ | When discount ends | Manual |
| **Coupon Code** | Single line text | ❌ | Custom coupon code | Manual |

### **Features & Content**
| Field Name | Type | Required | Description | Manual/Auto |
|------------|------|----------|-------------|-------------|
| **Features** | Multiple select | ❌ | Key features/benefits | Manual |
| **Created At** | Created time | ✅ | Auto timestamp | Auto |
| **Updated At** | Last modified time | ✅ | Auto timestamp | Auto |

## 🔧 Airtable Formula Fields Setup

### **Seats Available Formula:**
```
IF({Max Seats}, {Max Seats} - {Seats Taken}, "Unlimited")
```

### **Enrollment Status Formula:**
```
IF(
  {Max Seats},
  IF(
    {Seats Taken} >= {Max Seats},
    "Full",
    IF(
      {Seats Taken} >= {Max Seats} * 0.9,
      "Almost Full",
      "Open"
    )
  ),
  "Unlimited"
)
```

## 📋 Single Select Options

### **Service Type Options:**
- Course
- Build  
- Audit
- Consultation

### **Category Options:**
- Web Development
- Business Strategy
- Technical Skills
- Marketing
- Design

### **Features Options:**
- Live Sessions
- 1-on-1 Support
- Project Reviews
- Lifetime Access
- Certificate
- Community Access
- Recording Included
- Source Code Included

## 🚀 Step-by-Step Setup Process

### **Step 1: Create Base Structure (Manual)**
1. Add all core fields listed above
2. Set field types and requirements
3. Create single select options
4. Add formula fields

### **Step 2: Add Sample Services (Manual)**
```
Service 1:
- Service Name: "Complete Web Development Course"
- Service Type: Course
- Price: $297
- Max Seats: 25
- Category: Web Development
- Order: 1
- Is Active: ✅
- Features: [Live Sessions, 1-on-1 Support, Certificate]

Service 2:
- Service Name: "Custom Website Build"
- Service Type: Build
- Price: $2997
- Max Seats: 3
- Category: Web Development  
- Order: 2
- Is Active: ✅
- Features: [1-on-1 Support, Project Reviews, Source Code Included]
```

### **Step 3: Auto-Generate Stripe Products**
Use your existing API endpoint:
```bash
curl -X POST http://localhost:3000/api/services/sync \
  -H "Authorization: Bearer your-admin-token" \
  -H "Content-Type: application/json" \
  -d '{"action": "sync_all"}'
```

This will automatically populate:
- Stripe Product ID
- Stripe Price ID

## 🎯 Enrollment Tracking System

### **Purchase Tracking Table** (New Table)
Create a separate "Service Purchases" table:

| Field Name | Type | Description |
|------------|------|-------------|
| **Purchase ID** | Auto number | Unique purchase ID |
| **Service** | Link to Services | Which service was purchased |
| **Customer Email** | Email | Buyer's email |
| **Customer Name** | Single line text | Buyer's name |
| **Amount Paid** | Currency | Amount paid |
| **Purchase Date** | Created time | When purchased |
| **Payment Status** | Single select | succeeded, pending, refunded |
| **Stripe Payment ID** | Single line text | Stripe payment intent ID |

### **Auto-Update Seats Taken**
In your Services table, make "Seats Taken" a **Count** field that counts linked records from Service Purchases where Payment Status = "succeeded".

## 🔄 Automation Setup

### **Airtable Automation 1: Enrollment Limits**
**Trigger:** When Service Purchases record created
**Condition:** Service's Seats Available ≤ 0
**Action:** Send email notification + Update service status

### **Webhook Integration** (Your existing system)
Your purchase API should:
1. Create record in Service Purchases table
2. Airtable auto-updates Seats Taken count
3. Formula fields auto-calculate availability

## 💻 Code Integration

Update your service purchase API to handle seat limits:

```typescript
// In your purchase API
const service = await getServiceFromAirtable(serviceId)

if (service.fields['Max Seats'] && 
    service.fields['Seats Taken'] >= service.fields['Max Seats']) {
  return NextResponse.json({
    error: 'Service is full - no seats available'
  }, { status: 400 })
}

// Proceed with purchase...
```

## ✅ Quick Start Checklist

- [ ] Add all required fields to Services table
- [ ] Create formula fields for seat calculation
- [ ] Add 2-3 sample services with seat limits
- [ ] Create Service Purchases table
- [ ] Link tables with relationship field
- [ ] Run sync API to generate Stripe products
- [ ] Test purchase flow with seat limits
- [ ] Set up Airtable automations (optional)

## 🎯 What You Should Fill Manually vs Auto

### **Manual Fields (You Fill These):**
- Service Name, Description, Price
- Max Seats, Category, Order
- Sale Price, Discount info
- Features selection
- Is Active checkbox

### **Auto Fields (System Fills These):**
- Stripe Product ID, Stripe Price ID
- Seats Taken (count from purchases)
- Seats Available (formula)
- Enrollment Status (formula)
- Created At, Updated At

**Bottom Line:** You only manually set the business rules (price, capacity, features). The system handles all the technical integration and tracking automatically!

## 🚨 Important Notes

1. **Order Field:** Use 1, 2, 3, 4... for display order on your website
2. **Stripe IDs:** Leave blank initially - API will populate
3. **Seat Limits:** Set realistic numbers (25 for courses, 3-5 for custom builds)
4. **Testing:** Start with test services before adding real ones

This structure gives you complete enrollment management while maintaining your existing Stripe integration!